define(["app","weixin"],function(e,t){e.controller("WeiXinController",["$scope","$http","$window","$timeout","weixinService",function(e,n,r,i,s){var o={localId:[],serverId:[]};e.toast={upload:!1,message:""},e.chooseImage=function(){var e=r.navigator.userAgent.toLowerCase();if(e.match(/MicroMessenger/i)=="micromessenger")return s.getConfig().then(function(e){t.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","chooseImage","uploadImage"]}),t.chooseImage({success:function(e){o.localId=e.localIds}}),t.error(function(e){})})},e.upload=function(){function u(){t.uploadImage({localId:o.localId[r],success:function(t){r++,n.get(config.url.api+"/getMedia?media_id="+t.serverId).success(function(e){o.serverId.push(e)}),r<s?u():(o.localId=[],e.toast.message="上传完成",e.toast.upload=!0,i(function(){e.toast.upload=!1},900),e.$emit("imagePath",o.serverId))},fail:function(t){e.toast.message="上传失败，请重新选择照片上传",e.toast.upload=!0,i(function(){e.toast.upload=!1},900)}})}if(o.localId.length==0){e.toast.upload=!0,e.toast.message="请先选择照片",i(function(){e.toast.upload=!1},700);return}var r=0,s=o.localId.length;o.serverId=[],u()},t.onMenuShareAppMessage({title:"蜜蜂网印",desc:"蜜蜂网印",link:"http://www.mfwy.net/",imgUrl:"http://www.mfwy.net/UploadFolder/2015-04-17/20150417172835800470047-699-344.jpg",type:"",dataUrl:"",success:function(){e.$emit("shareSuccess","success"),e.toast.upload=!0,e.toast.message="分享成功",i(function(){e.toast.upload=!1},700)},cancel:function(){e.toast.upload=!0,e.toast.message="分享失败，请重新分享",i(function(){e.toast.upload=!1},700)}}),t.onMenuShareTimeline({title:"蜜蜂网印",link:"http://www.mfwy.net/",imgUrl:"http://www.mfwy.net/UploadFolder/2015-04-17/20150417172835800470047-699-344.jpg",success:function(){e.$emit("shareSuccess","success"),e.toast.upload=!0,e.toast.message="分享成功",i(function(){e.toast.upload=!1},700)},cancel:function(){e.toast.upload=!0,e.toast.message="分享失败，请重新分享",i(function(){e.toast.upload=!1},700)}})}])});